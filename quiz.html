<!DOCTYPE html>
<html>

<head>
    <title>AI Generated Quiz</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='quiz.css') }}">
</head>

<body>

    <div class="quiz-box">
        <h2>AI Generated Quiz</h2>

        <label>Subject</label>
        <!-- <input type="text" id="subject" value="{{ subject }}" readonly> -->
        <input type="text" id="subject" value="DSA" readonly>

        <label>Topic</label>
        <input type="text" id="topic" placeholder="Enter topic (eg: Arrays)">

        <label>Difficulty</label>
        <select id="difficulty">
            <option value="Easy">Easy</option>
            <option value="Medium">Medium</option>
            <option value="Hard">Hard</option>
        </select>

        <button onclick="generateQuiz()">Generate Quiz</button>

        <div id="quiz-area"></div>
    </div>

    <script>
        let correctAnswers = [];

        function generateQuiz() {
            const subject = document.getElementById("subject").value;
            const topic = document.getElementById("topic").value;
            const difficulty = document.getElementById("difficulty").value;

            fetch("/generate-quiz", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ subject, topic, difficulty })
            })
                .then(res => res.json())
                .then(data => {
                    let html = "";
                    correctAnswers = [];

                    data.forEach((q, index) => {
                        correctAnswers.push(q.answer);

                        html += `<p><b>Q${index + 1}. ${q.question}</b></p>`;
                        q.options.forEach(opt => {
                            html += `
                            <label>
                                <input type="radio" name="q${index}" value="${opt}">
                                ${opt}
                            </label><br>
                        `;
                        });
                        html += "<hr>";
                    });

                    html += `<button onclick="submitQuiz()">Submit Quiz</button>`;
                    html += `<h3 id="result"></h3>`;

                    document.getElementById("quiz-area").innerHTML = html;
                });
        }

        // function submitQuiz() {
        //     let score = 0;

        //     correctAnswers.forEach((answer, index) => {
        //         const selected = document.querySelector(
        //             `input[name="q${index}"]:checked`
        //         );
        //         if (selected && selected.value === answer) {
        //             score++;
        //         }
        //     });

        //     document.getElementById("result").innerHTML =
        //         `You scored ${score} / ${correctAnswers.length}`;
        // }/

        //let correctAnswers = [];

        function submitQuiz() {
            let score = 0;

            correctAnswers.forEach((correct, index) => {
                const options = document.getElementsByName(`q${index}`);
                let selected = null;

                options.forEach(opt => {
                    if (opt.checked) {
                        selected = opt.value;
                    }
                });

                options.forEach(opt => {
                    const label = opt.parentElement;

                    if (opt.value === correct) {
                        label.classList.add("correct");
                    }

                    if (opt.checked && opt.value !== correct) {
                        label.classList.add("wrong");
                    }
                });

                if (selected === correct) {
                    score++;
                }
            });

            document.getElementById("result").innerText =
                `You scored ${score} / ${correctAnswers.length}`;
        }


    </script>


</body>

</html>
